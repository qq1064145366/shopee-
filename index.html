<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å½±é¢¨ç‰©æµç®¡ç†å·¥å…· - å°ˆæ¥­ç‰ˆ</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        :root { --primary: #007bff; --success: #28a745; --danger: #dc3545; --warning: #ffc107; --dark: #343a40; }
        body { font-family: "Microsoft YaHei", sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .app-card { background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); max-width: 1400px; margin: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--primary); margin-bottom: 20px; padding-bottom: 10px; }
        
        /* æŒ‰éˆ•çµ„ */
        .toolbar { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        button { border: none; padding: 10px 16px; border-radius: 6px; color: #fff; cursor: pointer; font-weight: 500; transition: 0.2s; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-add { background: var(--success); }
        .btn-del { background: var(--danger); }
        .btn-save { background: var(--primary); }
        .btn-clear { background: var(--dark); }
        .btn-tool { background: #6f42c1; }

        /* åŒæ­¥èˆ‡æœç´¢å€ */
        .action-panel { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #e9ecef; margin-bottom: 20px; }
        .input-row { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
        .input-box { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }

        /* è¡¨æ ¼æ¨£å¼ */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #e9ecef; padding: 12px; border: 1px solid #dee2e6; color: #495057; font-size: 14px; }
        td { padding: 8px; border: 1px solid #dee2e6; text-align: center; }
        .row-num { color: var(--danger); font-weight: bold; }
        input[type="text"] { width: 90%; padding: 6px; border: 1px solid #eee; border-radius: 4px; text-align: center; }
        tr:hover { background: #fdfdfe; }

        /* æ¨™é¡Œç”Ÿæˆå™¨å°è¦–çª— */
        .modal { background: #fffbe6; padding: 15px; border: 1px solid #ffe58f; border-radius: 8px; margin-bottom: 20px; }
    </style>
</head>
<body>

<div id="app" class="app-card">
    <div class="header">
        <h2>ğŸ“¦ æ‹å–®ç‰©æµæ‰¹é‡ç®¡ç†å·¥å…·</h2>
        <div style="font-size: 12px; color: #888;">ç‰ˆæœ¬ï¼š2026.02.27 | æœ¬åœ°æ•¸æ“šå·²åŠ å¯†ä¿å­˜</div>
    </div>

    <div v-if="showTool" class="modal">
        <strong>ğŸ”¥ GMV Max æ¨™é¡ŒåŠ©æ‰‹ï¼š</strong> 
        <input v-model="toolKey" placeholder="è¼¸å…¥æ ¸å¿ƒç”¢å“è©..." style="padding:5px; width:200px;">
        <button class="btn-tool" @click="generateTitle" style="padding:5px 10px; font-size:12px;">ç”Ÿæˆæ¨™é¡Œ</button>
        <span style="margin-left:15px; color:#555;">å»ºè­°ï¼š{{ suggestTitle }}</span>
    </div>

    <div class="toolbar">
        <button class="btn-add" @click="addRow">+ æ–°å¢ä¸€è¡Œ</button>
        <button class="btn-del" @click="deleteSelected">- åˆªé™¤é¸ä¸­è¡Œ</button>
        <button class="btn-save" @click="exportCSV">ğŸ’¾ å°å‡ºæ•¸æ“šå‚™ä»½ (CSV)</button>
        <button class="btn-clear" @click="clearAll">ğŸ—‘ï¸ æ¸…ç©ºè¡¨æ ¼</button>
        <button class="btn-tool" @click="showTool = !showTool">ğŸ’¡ æ¨™é¡ŒåŠ©æ‰‹</button>
    </div>

    <div class="action-panel">
        <div class="input-row">
            <input type="text" class="input-box" v-model="pasteValue" placeholder="ç²˜è²¼ç™¾åº¦/æŸ¥ä»¶ç¶²é ç²å–çš„ç‰©æµç‹€æ…‹ (å¦‚ï¼šå·²ç°½æ”¶/é‹è¼¸ä¸­)">
            <button style="background: var(--warning); color: #000;" @click="syncStatus">âœ… åŒæ­¥ç‹€æ…‹åˆ°é¸ä¸­è¡Œ</button>
        </div>
        <div class="input-row">
            <input type="text" class="input-box" v-model="searchQuery" placeholder="ğŸ” ä¸‰åˆä¸€æœç´¢ï¼šè¨‚å–®è™Ÿ / å¹³å°å–®è™Ÿ / ç‰©æµå–®è™Ÿ">
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th width="50">åºè™Ÿ</th>
                <th width="40"><input type="checkbox" @change="toggleAll"></th>
                <th>è¨‚å–®è™Ÿ *</th>
                <th>å¹³å°å–®è™Ÿ</th>
                <th>ç‰©æµå–®è™Ÿ *</th>
                <th>ç‰©æµå…¬å¸</th>
                <th>ç‰©æµç‹€æ…‹</th>
                <th>è‡ªå‹•ä¿å­˜æ™‚é–“</th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="(item, index) in filteredRows" :key="item.id">
                <td class="row-num">{{ index + 1 }}</td>
                <td><input type="checkbox" v-model="item.selected"></td>
                <td><input type="text" v-model="item.orderId"></td>
                <td><input type="text" v-model="item.platformId"></td>
                <td><input type="text" v-model="item.expressId"></td>
                <td><input type="text" v-model="item.company"></td>
                <td><input type="text" v-model="item.status" style="color:var(--primary); font-weight:bold;"></td>
                <td style="font-size: 11px; color:#999;">{{ item.saveTime }}</td>
            </tr>
        </tbody>
    </table>
</div>

<script>
    const { createApp, ref, computed, watch, onMounted } = Vue;

    createApp({
        setup() {
            const rows = ref([]);
            const pasteValue = ref('');
            const searchQuery = ref('');
            const showTool = ref(false);
            const toolKey = ref('');
            const suggestTitle = ref('');
            const STORAGE_KEY = 'SHOPEE_ONLY_PRO_DATA';

            onMounted(() => {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) rows.value = JSON.parse(saved);
                else addRow();
            });

            watch(rows, (newVal) => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(newVal));
            }, { deep: true });

            const addRow = () => {
                rows.value.unshift({ id: Date.now(), selected: false, orderId: '', platformId: '', expressId: '', company: '', status: '', saveTime: '-' });
            };

            const syncStatus = () => {
                if (!pasteValue.value) return alert('è«‹å…ˆç²˜è²¼ç‰©æµä¿¡æ¯');
                rows.value.forEach(r => {
                    if (r.selected) {
                        r.status = pasteValue.value;
                        r.saveTime = new Date().toLocaleString();
                        r.selected = false;
                    }
                });
                pasteValue.value = '';
            };

            const toggleAll = (e) => rows.value.forEach(r => r.selected = e.target.checked);
            const deleteSelected = () => rows.value = rows.value.filter(r => !r.selected);
            const clearAll = () => { if(confirm('ç¢ºå®šæ¸…ç©ºï¼Ÿ')) rows.value = []; };

            const exportCSV = () => {
                let csv = "\uFEFFåºè™Ÿ,è¨‚å–®è™Ÿ,å¹³å°å–®è™Ÿ,ç‰©æµå–®è™Ÿ,ç‰©æµå…¬å¸,ç‹€æ…‹,æ›´æ–°æ™‚é–“\n";
                rows.value.forEach((r, i) => { csv += `${i+1},${r.orderId},${r.platformId},${r.expressId},${r.company},${r.status},${r.saveTime}\n`; });
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = `ç‰©æµæ•¸æ“š_${new Date().toLocaleDateString()}.csv`;
                link.click();
            };

            const generateTitle = () => {
                if(!toolKey.value) return;
                // é›†æˆæ‚¨çš„ GMV Max å…¬å¼ï¼šå»å½¢å®¹è©ã€é‡åè©ã€å ´æ™¯åŒ– [cite: 2026-01-09]
                suggestTitle.value = `ğŸ”¥ ã€ç²¾é¸ã€‘${toolKey.value} è§£æ±ºæ–¹æ¡ˆ å°ˆæ¥­ç´šè¦æ ¼ è¾¦å…¬/å±…å®¶å¿…å‚™ ç¾è²¨ä¾›æ‡‰`;
            };

            const filteredRows = computed(() => {
                if (!searchQuery.value) return rows.value;
                const q = searchQuery.value.toLowerCase();
                return rows.value.filter(r => r.orderId.includes(q) || r.platformId.includes(q) || r.expressId.includes(q));
            });

            return { rows, pasteValue, searchQuery, showTool, toolKey, suggestTitle, filteredRows, addRow, syncStatus, toggleAll, deleteSelected, clearAll, exportCSV, generateTitle };
        }
    }).mount('#app');

    // è¨»å†Š Service Worker è§£æ±º PWABuilder é›¢ç·šå ±éŒ¯
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('service-worker.js');
        });
    }
</script>
</body>
</html>
